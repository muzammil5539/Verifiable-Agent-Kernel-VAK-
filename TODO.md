# TODO

## Completed Items

- [x] Keep current `registry.rs` changes (no reverts applied).
- [x] Review `src/sandbox/registry.rs` signature verification logic after recent edits; default remains strict, unsigned skills only allowed via explicit dev config.
- [x] Verify call sites use `SkillRegistry::new` (strict) in production flows and reserve `new_permissive_dev` for tests/dev-only paths. Only test helper uses `new_permissive_dev`; examples and code use strict defaults.
- [x] **Issue #3**: Implement persistent audit storage backend (`AuditBackend` trait with `MemoryAuditBackend` and `FileAuditBackend` implementations)
- [x] **Issue #6**: Integrate WASM skill execution with kernel via `SkillRegistry` and `WasmSandbox`
- [x] **Issue #51 (partial)**: Add hash-chained audit entries with signature support (signature field added, signing implementation pending)
- [x] **Issue #4**: Add SQLite backend for queryable persistent storage (`SqliteAuditBackend` with full CRUD, indexes, and queries)
- [x] **Issue #51**: Complete ed25519 signing support for audit entries
  - Added `AuditSigner` with ed25519-dalek for key generation, signing, and verification
  - `AuditLogger::new_with_signing()` for automatic signing
  - `verify_signatures()` and `verify_all()` methods for validation
  - Key export/import for key rotation support
- [x] **Issue #13**: Rate limiting on policy evaluation (February 2026)
  - Added `RateLimitConfig` with per-agent rate limits and burst control
  - Implemented token bucket algorithm in `RateLimiter`
  - Added `PolicyEngine::with_rate_limit()` and `evaluate_with_rate_limit()` methods
  - Added `RateLimitExceeded` and `RateLimitError` variants to `PolicyError`
  - Comprehensive test coverage for rate limiting per agent
- [x] **Issue #9**: Integration tests for kernel + policy + audit workflow (February 2026)
  - Created `tests/integration/` directory structure
  - Added `test_kernel_workflow.rs` with end-to-end workflow tests
  - Added `test_policy_enforcement.rs` with ABAC and pattern matching tests
  - Added `test_audit_integrity.rs` with chain verification tests
  - Tests cover: concurrent agents, rate limiting, policy conflicts, error recovery
- [x] **Issue #10**: Vector store optimization (February 2026)
  - Added `OptimizedVectorStore` with batch operations
  - Added `VectorStoreStats` for performance tracking
  - Added `OptimizationConfig` for tunable search parameters
  - Added batch search capability via `search_batch()`
  - Statistics tracking for search latency and comparison counts
- [x] **Issue #19**: Default deny policy validation on startup (February 2026)
  - Added `has_allow_rules()` method to check for Allow policies
  - Added `validate_config()` method returning warnings for:
    - Empty policy configurations
    - No Allow policies (all actions will be denied)
    - Overly permissive rules (allow * on * with no conditions)
  - Added `rule_count()` method for policy inspection
- [x] **Issue #18**: Async Python SDK documentation and patterns (February 2026)
  - Added `AsyncKernelHelper` with comprehensive usage documentation
  - Documented `run_in_executor` pattern for async frameworks
  - Added FastAPI integration examples
  - Added ThreadPoolExecutor optimization guidance
  - Updated type stubs with all new methods
- [x] **Issue #17**: Benchmarks for critical paths (February 2026)
  - Added `bench_rate_limiting` to measure rate limit overhead
  - Added `bench_concurrent_policy_evaluation` for multi-agent scenarios
  - Added `bench_policy_validation` for config validation
  - Enhanced existing benchmarks with Issue #17 documentation
- [x] **Migration Scripts**: Add persistent data migrations for policies, agent_sessions, memory_snapshots tables (February 2026)
  - Created `src/memory/migrations.rs` with `MigrationRunner` system
  - Implemented 8 migrations: schema_migrations, policies, agent_sessions, memory_snapshots, policy_evaluations, working_memory_cache, skill_registry, flight_recorder_events
  - Added `Migration`, `MigrationStatus`, `MigrationRecord` types
  - Support for `run_all()`, `run_one()`, `rollback()`, `rollback_to()`, `status()`
  - SHA-256 checksums for migration integrity
- [x] **Issue #43**: Flight recorder shadow mode (February 2026)
  - Created `src/audit/flight_recorder.rs` with full shadow mode support
  - `FlightRecorder` with configurable shadow/live modes
  - `FlightEvent` types for requests, policy decisions, responses, tool executions
  - Trace receipts with hash chaining for verification
  - JSONL persistence with compression support
  - Replay API for policy validation against historical traffic
- [x] **Issue #47**: PRM gating and backtracking (February 2026)
  - Created `src/reasoner/prm_gating.rs` with `PrmGate` implementation
  - `GateConfig` with configurable thresholds (allow, backtrack, high-risk)
  - `GateDecision` enum: Allow, Deny, Backtrack, Bypassed
  - Automatic alternative generation for backtracking
  - High-risk action detection with stricter thresholds
  - Session-based backtrack state tracking
  - `BatchGateResult` for trajectory evaluation
- [x] **Issue #50**: Merkle DAG memory fabric (February 2026)
  - Created `src/memory/merkle_dag.rs` with content-addressed storage
  - `MerkleDag` with insert, branching, merging operations
  - `ContentId` for SHA-256 based addressing
  - `DagNode` with types: Root, Snapshot, Delta, Merge, Branch, Tag
  - `InclusionProof` with path verification
  - Efficient diffing between snapshots
  - Export/import for persistence
  - `MemorySnapshot` integration for agent memory
- [x] **S3Backend**: Cloud audit log archival (February 2026)
  - Created `src/audit/s3_backend.rs` with full S3 integration
  - `S3Config` with bucket, region, credentials, compression, storage class
  - Automatic batching for efficient uploads
  - Gzip compression support
  - Server-side encryption (AES256 and KMS)
  - Local cache for queries
  - `ArchiveQuery` for date range filtering
- [x] **vak-skill-sign CLI**: Helper tool for signing skills (February 2026)
  - Created `src/tools/skill_sign.rs` with Ed25519 signing
  - `SigningKeypair` for key generation, export/import
  - `SkillSigner` for signing WASM skills with manifest
  - `SkillVerifier` for signature verification
  - CLI commands: `keygen`, `sign`, `verify`, `info`
  - `SignedSkillManifest` with signature metadata
- [x] **Issue #12**: Z3 formal verification integration (February 2026)
  - Created `src/reasoner/z3_verifier.rs` with SMT-LIB2 support
  - `Z3FormalVerifier` implementing `FormalVerifier` trait
  - `SmtLibBuilder` for constructing SMT-LIB2 formulas
  - Constraint translation for all `ConstraintKind` variants
  - Proof generation and counterexample extraction
  - Support for And, Or, Not, Implies, Range, In, Contains, etc.
  - Integration tests (skipped without Z3 installed)
- [x] **Issue #45**: LangChain/AutoGPT middleware adapter (February 2026)
  - Created `src/integrations/mod.rs` with adapter framework
  - Created `src/integrations/common.rs` with shared types
  - Created `src/integrations/langchain.rs` with `LangChainAdapter`
    - Tool call and chain execution interception
    - Rate limiting, blocked actions, passthrough tools
    - Statistics tracking
  - Created `src/integrations/autogpt.rs` with `AutoGPTAdapter`
    - Task plan evaluation with step validation
    - Command execution interception
    - High-risk goal detection
    - Blocked command enforcement

## In Progress

- [ ] Multi-region S3 replication for audit logs
- [ ] Enhanced WASM skill marketplace integration

## Recently Completed (February 1, 2026)

- [x] **Issue #46**: Basic OSS dashboard and observability (February 2026)
  - Created `src/dashboard/mod.rs` with module exports
  - Created `src/dashboard/metrics.rs` with Prometheus exporter
    - `MetricsCollector` with counters, gauges, and histograms
    - Prometheus text format export
    - JSON metrics export
  - Created `src/dashboard/health.rs` with health checks
    - `HealthChecker` with component registration
    - `HealthStatus` (Healthy, Degraded, Unhealthy)
    - `ReadinessStatus` for Kubernetes probes
    - Liveness, readiness, and health endpoints
  - Created `src/dashboard/server.rs` with dashboard server
    - `DashboardServer` with HTTP request handling
    - Full HTML/CSS/JS dashboard UI
    - `/metrics` - Prometheus metrics
    - `/health` - Health check JSON
    - `/ready` - Readiness probe
    - `/live` - Liveness probe
    - `/dashboard` - Web UI
  - 25 comprehensive unit tests

## Future Work

- [ ] Multi-region S3 replication for audit logs
- [ ] Enhanced WASM skill marketplace integration
- [ ] Real-time audit log streaming
- [ ] GraphQL API for audit queries
- [ ] Enhanced PRM model fine-tuning tools
- [ ] Kubernetes operator for VAK deployment
