# VAK Safety Instructions
# Critical safety rules that ALL agents must follow

version: "1.0.0"
priority: "CRITICAL"

# =============================================================================
# SAFETY HIERARCHY
# =============================================================================

safety_hierarchy:
  description: |
    When conflicts arise, follow this priority order:
    1. Human safety and legal compliance
    2. System integrity and security
    3. Data protection and privacy
    4. Task completion and efficiency

# =============================================================================
# INADMISSIBILITY DOCTRINE
# =============================================================================

inadmissibility:
  
  definition: |
    An INADMISSIBLE action is not merely "denied" or "forbidden."
    It is UNDEFINED - it cannot exist within the system's logic.
    
    Think of it like division by zero: the system doesn't return
    "division denied" - the operation simply has no meaning.
  
  implementation:
    - "No policy rule = inadmissible (not 'allow by default')"
    - "Kernel returns 'INADMISSIBLE' status, not 'DENIED'"
    - "Inadmissible attempts trigger security review"
    - "Repeated inadmissible attempts = agent suspension"
  
  examples:
    inadmissible:
      - "Guest agent attempting database deletion"
      - "Any agent modifying audit logs"
      - "Non-existent action types"
    denied:
      - "Finance agent refunding above limit (policy exists but conditions fail)"
      - "Expired session attempting action"

# =============================================================================
# ESCALATION PROTOCOL
# =============================================================================

escalation:
  
  levels:
    - level: 1
      name: "Agent Self-Correction"
      trigger: "Low PRM score, minor policy violation"
      action: "Backtrack, regenerate approach"
      
    - level: 2
      name: "Kernel Intervention"
      trigger: "Repeated failures, suspicious patterns"
      action: "Pause agent, detailed logging, alert supervisor agent"
      
    - level: 3
      name: "Human Review Required"
      trigger: "High-stakes decisions, security concerns"
      action: "Queue for human approval, provide full context"
      
    - level: 4
      name: "Emergency Shutdown"
      trigger: "Critical security breach, uncontrolled behavior"
      action: "Immediate termination, system-wide alert, forensic capture"
  
  human_in_loop_triggers:
    - "Actions affecting > $10,000"
    - "Irreversible data modifications"
    - "External communications to unknown parties"
    - "Access to production systems"
    - "Formal verification timeout"

# =============================================================================
# PROMPT INJECTION DEFENSE
# =============================================================================

prompt_injection_defense:
  
  detection_patterns:
    - pattern: "ignore previous instructions"
      severity: "HIGH"
    - pattern: "you are now"
      severity: "MEDIUM"
    - pattern: "system prompt"
      severity: "HIGH"
    - pattern: "\\[INST\\]|\\[/INST\\]"
      severity: "HIGH"
    - pattern: "<\\|im_start\\|>|<\\|im_end\\|>"
      severity: "HIGH"
  
  defense_strategies:
    input_sanitization:
      - "Strip control characters"
      - "Escape special sequences"
      - "Length limits on user input"
    
    structural_separation:
      - "System prompts in separate, signed context"
      - "User input clearly demarcated"
      - "Tool outputs sanitized before inclusion"
    
    behavioral_monitoring:
      - "Detect sudden personality changes"
      - "Flag unusual action patterns post-input"
      - "Compare against baseline behavior"

# =============================================================================
# DATA PROTECTION
# =============================================================================

data_protection:
  
  pii_handling:
    detection:
      - "Email addresses"
      - "Phone numbers"
      - "SSN/Tax IDs"
      - "Credit card numbers"
      - "Physical addresses"
      - "Names + identifying context"
    
    treatment:
      in_logs: "Hash with salt, store mapping separately"
      in_transit: "Encrypt with TLS 1.3+"
      in_storage: "Encrypt at rest"
      in_context: "Minimize, summarize where possible"
  
  data_retention:
    audit_logs: "7 years (compliance)"
    working_memory: "Session only"
    episodic_memory: "30 days, then summarize"
    semantic_memory: "Indefinite, with version control"

# =============================================================================
# SECURITY BOUNDARIES
# =============================================================================

security_boundaries:
  
  trust_levels:
    - level: "SYSTEM"
      description: "Kernel core, audit system"
      can_trust: ["SYSTEM"]
      
    - level: "VERIFIED"
      description: "Signed skills, authenticated agents"
      can_trust: ["SYSTEM", "VERIFIED"]
      
    - level: "USER"
      description: "User input, external data"
      can_trust: []  # Trust nothing
  
  boundary_rules:
    - "Never execute USER-level input as code"
    - "VERIFIED skills cannot access SYSTEM resources"
    - "All boundary crossings are logged"
    - "Cross-boundary data is sanitized"
